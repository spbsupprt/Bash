# Bash

Описание/Пошаговая инструкция выполнения домашнего задания:

Написать скрипт для CRON, который раз в час будет формировать письмо и отправлять на заданную почту.


Необходимая информация в письме:

- Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
- Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
- Ошибки веб-сервера/приложения c момента последнего запуска;
- Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта.
- Скрипт должен предотвращать одновременный запуск нескольких копий, до его завершения.

В письме должен быть прописан обрабатываемый временной диапазон.

Трапы и функции, а также sed и find


Т.к. Сеть изолирована и преподователь сообщил что почтовый сервер это лишнее, работу сделал в рамках cron и запись в отдельный лог. 

Дано:

![image](https://github.com/user-attachments/assets/4649b5af-04a0-4f21-b507-ebe6d864a7c6)


Со сторонных vm нагенерировал запросы:

![image](https://github.com/user-attachments/assets/e189180f-b389-4a06-8918-8bc3f9c3c639)

Выполняем задание:

- Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;

awk '{print $1}' /var/log/nginx/access.log* | sort| uniq -c | sort -n

- Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;

awk '{print $6$7$8}' /var/log/nginx/access.log* | sort| uniq -c | sort -n

- Ошибки веб-сервера/приложения c момента последнего запуска;

cat /var/log/nginx/error.log* | sort | uniq -c 

- Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта.

awk '{print $9}' /var/log/nginx/access.log* | grep -P "[0-9]{3}" | sort | uniq -c| sort -n

- Скрипт должен предотвращать одновременный запуск нескольких копий, до его завершения.

Сделаем его через Cron чтобы следил за запуском.

Скрипт mail_for_nginx.sh

вывод crontab -e

![image](https://github.com/user-attachments/assets/49d85bfa-1553-445f-8f05-8e261c5ef8b8)


Результат:

![image](https://github.com/user-attachments/assets/d54617c4-9051-4d07-a7c7-3a4f67856b7c)

Вывод:

![image](https://github.com/user-attachments/assets/130f3dad-a9ed-474f-a5e7-c3c231d5aaf3)



